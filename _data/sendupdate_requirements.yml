requirements:

#Core Update Record payload structure requirements  
- id: GPCM-SU-001
  area: sendupdatepayload
  description: "the ITK3 <code>MessageHeader.focus</code> element <strong>MUST</strong> be a reference to a <a href=\"https://www.hl7.org/fhir/STU3/bundle.html\">Bundle</a> resource which conforms to the <a href=\"https://fhir.nhs.uk/STU3/StructureDefinition/ITK-Document-Bundle-1\">ITK-Document-Bundle</a> profile"
  page: sendupdate_payload_structure.html

- id: GPCM-SU-002
  area: sendupdatepayload
  description: "the <code>ITK-Document-Bundle</code> <strong>MUST</strong> contain a Composition resource profiled to <a href=\"https://fhir.hl7.org.uk/STU3/StructureDefinition/CareConnect-Composition-1\">CareConnect-Composition-1</a> base resource"
  page: sendupdate_payload_structure.html

- id: GPCM-SU-003
  area: sendupdatepayload
  description: "the <a href=\"https://fhir.hl7.org.uk/STU3/StructureDefinition/CareConnect-Composition-1\">CareConnect-Composition</a> <code>Composition.custodian</code> element <strong>MUST</strong> contain an Organization resource which conforms to the <a href=\"https://fhir.hl7.org.uk/STU3/StructureDefinition/CareConnect-Organization-1\">CareConnect-Organization-1</a> profile describing the organisation which sends the message"
  page: sendupdate_payload_structure.html

- id: GPCM-SU-004
  area: sendupdatepayload
  description: "where the message contains patient information, for example as a result of a healthcare event, the <a href=\"https://fhir.hl7.org.uk/STU3/StructureDefinition/CareConnect-Composition-1\">CareConnect-Composition</a> <code>Composition.subject</code> element <strong>MUST</strong> contain a patient resource which conforms to the <a href=\"https://fhir.hl7.org.uk/STU3/StructureDefinition/CareConnect-Patient-1\">CareConnect-Patient-1</a> profile"
  page: sendupdate_payload_structure.html

- id: GPCM-SU-005
  area: sendupdatepayload
  description: "the <a href=\"https://fhir.hl7.org.uk/STU3/StructureDefinition/CareConnect-Composition-1\">CareConnect-Composition</a> <code>Composition.author</code> element <strong>MUST</strong> contain one or more references to the individual or device that has authored the data in the payload. This includes the following resources: <ul><li>a Practitioner resource profiled to <a href=\"https://fhir.hl7.org.uk/STU3/StructureDefinition/CareConnect-Practitioner-1\">CareConnect-Practitioner-1</a></li><li>a Patient resource profiled to <a href=\"https://fhir.hl7.org.uk/STU3/StructureDefinition/CareConnect-Patient-1\">CareConnect-Patient-1</a></li><li>a RelatedPerson resource profiled to <a href=\"https://fhir.hl7.org.uk/STU3/StructureDefinition/CareConnect-RelatedPerson-1\">CareConnect-RelatedPerson-1</a></li><li>a Device resource profiled to <a href=\"https://fhir.nhs.uk/STU3/StructureDefinition/ITK-Device-1\">ITK-Device-1</a></li></ul>"
  page: sendupdate_payload_structure.html  

- id: GPCM-SU-006
  area: sendupdatepayload
  description: "where the message contains encounter information, a <code>Composition.encounter</code> referencing a <a href=\"https://fhir.hl7.org.uk/STU3/StructureDefinition/CareConnect-Encounter-1\">CareConnect-Encounter-1</a> <strong>SHOULD</strong> be present"
  page: sendupdate_payload_structure.html 

- id: GPCM-SU-007
  area: sendupdatepayload
  description: "where the message contains observation information, a <code>Composition.section.entry</code> referencing a <a href=\"https://fhir.hl7.org.uk/STU3/StructureDefinition/CareConnect-List-1\">CareConnect-List-1</a> <strong>SHOULD</strong> be present. This resource lists all the observations present in the payload."
  page: sendupdate_payload_structure.html 
  
- id: GPCM-SU-008
  area: sendupdatepayload
  description: "observations referenced in the the <code>CareConnect-List-1</code> <strong>SHOULD</strong> each populate a <code>Composition.section.entry</code> referencing an Observation resource which conforms to the <a href=\"https://fhir.hl7.org.uk/STU3/StructureDefinition/CareConnect-Observation-1\">CareConnect-Observation-1</a> profile, describing each observation"
  page: sendupdate_payload_structure.html 

- id: GPCM-SU-009
  area: sendupdatepayload
  description: "where a message contains questionnaire information, a <code>Composition.section.entry</code> referencing a <a href=\"https://fhir.hl7.org.uk/STU3/StructureDefinition/CareConnect-Questionnaire-1\">CareConnect-Questionnaire-1</a> <strong>SHOULD</strong> be present. This resource fully describes questionnaire being completed"
  page: sendupdate_payload_structure.html 

- id: GPCM-SU-010
  area: sendupdatepayload
  description: "where a message contains questionnaire response information, a <code>Composition.section.entry</code> referencing a <a href=\"https://fhir.hl7.org.uk/STU3/StructureDefinition/CareConnect-QuestionnaireResponse-1\">CareConnect-QuestionnaireResponse-1</a> <strong>SHOULD</strong> be present. This resource describes all the questions asked to the patient and all the responses given"
  page: sendupdate_payload_structure.html 
  
- id: GPCM-SU-011
  area: sendupdatepayload
  description: "where a message contains a referral request, a <code>Composition.section.entry</code> referencing a <a href=\"https://fhir.hl7.org.uk/STU3/StructureDefinition/CareConnect-ReferralRequest-1\">CareConnect-ReferralRequest-1</a> <strong>SHOULD</strong> be present"
  page: sendupdate_payload_structure.html
 
- id: GPCM-SU-012
  area: sendupdatepayload
  description: "where a message contains a document, a <code>Composition.section.entry</code> referencing a <a href=\"https://fhir.hl7.org.uk/STU3/StructureDefinition/CareConnect-DocumentReference-1\">CareConnect-DocumentReference-1</a> <strong>SHOULD</strong> be present"
  page: sendupdate_payload_structure.html

- id: GPCM-SU-013
  area: sendupdatepayload
  description: "where a message contains an allergy or intolerance, a <code>Composition.section.entry</code> referencing a <a href=\"https://fhir.hl7.org.uk/STU3/StructureDefinition/CareConnect-AllergyIntolerance-1\">CareConnect-AllergyIntolerance-1</a> <strong>SHOULD</strong> be present"
  page: sendupdate_payload_structure.html

- id: GPCM-SU-014
  area: sendupdatepayload
  description: "where a message contains any family member history, a <code>Composition.section.entry</code> referencing a <a href=\"https://fhir.hl7.org.uk/STU3/StructureDefinition/CareConnect-FamilyMemberHistory-1\">CareConnect-FamilyMemberHistory-1</a> <strong>SHOULD</strong> be present"
  page: sendupdate_payload_structure.html

- id: GPCM-SU-015
  area: sendupdatepayload
  description: "where a message contains a task, a <code>Composition.section.entry</code> referencing a <a href=\"https://fhir.hl7.org.uk/STU3/StructureDefinition/CareConnect-Task-1\">CareConnect-Task-1</a> <strong>SHOULD</strong> be present"
  page: sendupdate_payload_structure.html

- id: GPCM-SU-016
  area: sendupdatepayload
  description: "where a message contains patient consent, a <code>Composition.section.entry</code> referencing a <a href=\"https://fhir.hl7.org.uk/STU3/StructureDefinition/CareConnect-Consent-1\">CareConnect-Consent-1</a> <strong>SHOULD</strong> be present"
  page: sendupdate_payload_structure.html

- id: GPCM-SU-017
  area: sendupdatepayload
  description: "where a message contains a location, a <code>Composition.section.entry</code> referencing a <a href=\"https://fhir.hl7.org.uk/STU3/StructureDefinition/CareConnect-Location-1\">CareConnect-Location-1</a> <strong>SHOULD</strong> be present"
  page: sendupdate_payload_structure.html

- id: GPCM-SU-018
  area: sendupdatepayload
  description: "where a message contains a medication, a <code>Composition.section.entry</code> referencing a <a href=\"https://fhir.hl7.org.uk/STU3/StructureDefinition/CareConnect-Medication-1\">CareConnect-Medication-1</a> <strong>SHOULD</strong> be present"
  page: sendupdate_payload_structure.html

- id: GPCM-SU-019
  area: sendupdatepayload
  description: "where a message contains a medication request, a <code>Composition.section.entry</code> referencing a <a href=\"https://fhir.hl7.org.uk/STU3/StructureDefinition/CareConnect-MedicationRequest-1\">CareConnect-MedicationRequest-1</a> <strong>SHOULD</strong> be present"
  page: sendupdate_payload_structure.html

- id: GPCM-SU-020
  area: sendupdatepayload
  description: "where a message contains a medication statement, a <code>Composition.section.entry</code> referencing a <a href=\"https://fhir.hl7.org.uk/STU3/StructureDefinition/CareConnect-MedicationStatement-1\">CareConnect-MedicationStatement-1</a> <strong>SHOULD</strong> be present"
  page: sendupdate_payload_structure.html
  
- id: GPCM-SU-0xx
  area: sendupdatepayload
  description: "where a message contains an immunization, a <code>Composition.section.entry</code> referencing a <a href=\"https://fhir.hl7.org.uk/STU3/StructureDefinition/CareConnect-Immunization-1\">CareConnect-Immunization-1</a> <strong>SHOULD</strong> be present"
  page: sendupdate_payload_structure.html

- id: GPCM-SU-021
  area: sendupdatepayload
  description: "where a message contains an problem, a <code>Composition.section.entry</code> referencing a <a href=\"https://fhir.hl7.org.uk/STU3/StructureDefinition/CareConnect-ProblemHeader-Condition-1\">CareConnect-ProblemHeader-Condition-1</a> <strong>SHOULD</strong> be present"
  page: sendupdate_payload_structure.html
  
- id: GPCM-SU-022
  area: sendupdatepayload
  description: "where a message contains a procedure, a <code>Composition.section.entry</code> referencing a <a href=\"https://fhir.hl7.org.uk/STU3/StructureDefinition/CareConnect-ProcedureRequest-1\">CareConnect-ProcedureRequest-1</a> <strong>SHOULD</strong> be present"
  page: sendupdate_payload_structure.html

- id: GPCM-SU-023
  area: sendupdatepayload
  description: "where a message contains a diagnostic report, a <code>Composition.section.entry</code> referencing a <a href=\"https://fhir.hl7.org.uk/STU3/StructureDefinition/CareConnect-DiagnosticReport-1\">CareConnect-DiagnosticReport-1</a> <strong>SHOULD</strong> be present"
  page: sendupdate_payload_structure.html

- id: GPCM-SU-024
  area: sendupdatepayload
  description: "where a message contains a specimen, a <code>Composition.section.entry</code> referencing a <a href=\"https://fhir.hl7.org.uk/STU3/StructureDefinition/CareConnect-Specimen-1\">CareConnect-Specimen-1</a> <strong>SHOULD</strong> be present"
  page: sendupdate_payload_structure.html  
  
- id: GPCM-SU-025
  area: sendupdatepayload
  description: "all <code>meta</code> elements <strong>MUST</strong> be treated as mandatory and populated with the associated resource"
  page: sendupdate_payload_structure.html

- id: GPCM-SU-026
  area: sendupdatepayload
  description: "when the same resource is listed in the payload multiple times, and relates to the same encounter, a <code>Composition.section.entry</code> referencing a <a href=\"https://fhir.hl7.org.uk/STU3/StructureDefinition/CareConnect-List-1\">CareConnect-List-1</a> <strong>SHOULD</strong> be used to contain the resources"
  page: sendupdate_payload_structure.html 
  
- id: GPCM-SU-027
  area: sendupdatepayload
  description: "all <code>meta</code> elements <strong>MUST</strong> be treated as mandatory and populated with the associated resource"
  page: sendupdate_payload_structure.html
  
- id: GPCM-SU-028
  area: sendupdatepayload
  description: "all <code>id</code> elements <strong>MUST</strong> be treated as mandatory, except when the resource is being created (initial creation call)"
  page: sendupdate_payload_structure.html

- id: GPCM-SU-029
  area: sendupdatepayload2
  description: "each binary document sent in the payload <strong>MUST</strong> be included as an instance of the <code>Composition.section</code> element"
  page: sendupdate_payload_structure.html

- id: GPCM-SU-030
  area: sendupdatepayload3
  description: "each <code>Composition.section.entry</code> <strong>MUST</strong> be a FHIR Reference containing a reference to an attachment profiled to <a href=\"https://fhir.nhs.uk/STU3/StructureDefinition/ITK-Attachment-Binary-1\">ITK-Attachment-Binary-1</a>"
  page: sendupdate_payload_structure.html

- id: GPCM-SU-031
  area: sendupdatepayload3
  description: "all attachments <strong>MUST</strong> be Base64 encoded"
  page: sendupdate_payload_structure.html
  
- id: GPCM-SU-032
  area: sendupdatepayload3
  description: "the primary attachment <strong>MUST</strong> be the first <code>Composition.section.entry</code> in the payload"
  page: sendupdate_payload_structure.html  


#Resend requirements
- id: GPCM-SU-033
  area: resend
  description: "Receivers of replacement messages <strong>MUST</strong> process the replacement message and archive the replaced message"
  tooltip: "Receivers of replacement messages MUST process the replacement message and archive the replaced message"
  page: sendupdate_resend.html

- id: GPCM-SU-034
  area: resend2
  description: "the receiver of the new message <strong>SHOULD</strong> mark the original and replacement message as null and void and report a error to the sender using the ITK Response message and appropriate code see <a href=\"https://developer.nhs.uk/apis/itk3messagedistribution/explore_response_codes.html\">ITK3 response codes</a> for further information"
  tooltip: "the receiver of the new message SHOULD mark the original and replacement message as null and void and report a error to the sender using the ITK Response message and appropriate code see ITK3 response codes for further information"
  page: sendupdate_resend.html

- id: GPCM-SU-035
  area: resend2
  description: "the sender of the new message <strong>SHOULD</strong> mark the original and replacement message as null and void once it receives the ITK3 Response indicating that the replacement message could not be processed"
  tooltip: "the sender of the new message SHOULD mark the original and replacement message as null and void once it receives the ITK3 Response indicating that the replacement message could not be processed"
  page: sendupdate_resend.html
  
- id: GPCM-SU-036
  area: resend3
  description: "replacements <strong>MAY</strong> be done more than once and the new message always refers to the previous message, multiple replacements <strong>SHOULD</strong> be avoided due to complexity of maintaining the audit trail"
  tooltip: "replacements MAY be done more than once and the new message always refers to the previous message, multiple replacements SHOULD be avoided due to complexity of maintaining the audit trail"
  page: sendupdate_resend.html

- id: GPCM-SU-037
  area: resend3
  description: "replacement messages <strong>SHOULD</strong> be sent within 24 hours of the original message"
  tooltip: "replacement messages <strong>SHOULD</strong> be sent within 24 hours of the original message"
  page: sendupdate_resend.html

- id: GPCM-SU-038
  area: resend4
  description: "<code>Composition.relatesTo.code</code> <strong>MUST</strong> contain the fixed value <code>replaces</code>"
  tooltip: "Composition.relatesTo.code MUST contain the fixed value replaces"
  page: sendupdate_resend.html

- id: GPCM-SU-039
  area: resend4
  description: "<code>Composition.relatesTo.targetIdentifier</code> <strong>MUST</strong> contain the identifier of the old message - UUID of original message"
  tooltip: "Composition.relatesTo.targetIdentifier MUST contain the identifier of the old message - UUID of original message"
  page: sendupdate_resend.html

#Error handling requirements
- id: GPCM-SU-040
  area: error
  description: "where the received message does not conform to the requirements stated for <a href=\"senddocument_fedcon_itk3.html\">ITK3 header</a>, or for the payload, the message <strong>MUST</strong> be considered invalid"
  tooltip: "where the received message does not conform to the requirements stated for ITK3 header, or for the payload, the message MUST be considered invalid"
  page: sendupdate_errors.html
  
- id: GPCM-SU-041
  area: error
  description: "where a received message is invalid, an ITK3 Response <strong>MUST</strong> be generated, with the corresponding Negative ITK3 Response Code which indicates the nature of the error, and the message <strong>MUST NOT</strong> be accepted for downstream processing"
  tooltip: "where a received message is invalid, an ITK3 Response MUST be generated, with the corresponding Negative ITK3 Response Code which indicates the nature of the error, and the message MUST NOT be accepted for downstream processing"
  page: sendupdate_errors.html
  
- id: GPCM-SU-042
  area: error3
  description: "error context and description <strong>MUST</strong> be provided in the <code>OperationOutcome.diagnostic</code> element to enable the sender to correctly identify the error which has been found in their sent message"
  tooltip: "error context and description MUST be provided in the 'OperationOutcome.diagnostic' element"
  page: sendupdate_errors.html
     
- id: GPCM-SU-043
  area: error4
  description: "the following errors, when encountered, <strong>MUST</strong> be handled gracefully by the message sending system"
  tooltip:
  page: sendupdate_errors.html

- id: GPCM-SU-044
  area: error5
  description: "where a Consultation Report is not successfully received/managed by the message receiver, the sender system <strong>MUST</strong> inform an appropriate person"
  tooltip: "where a Consultation Report is not successfully received/managed by the message receiver, the sender system MUST inform an appropriate person"
  page: sendupdate_errors.html

- id: GPCM-SU-045
  area: error5
  description: "where either the infrastructure or business acknowledgements, or both, are not received for a Consultation Report, the sender system <strong>MUST</strong> inform an appropriate person"
  tooltip: "where either the infrastructure or business acknowledgements, or both, are not received for a Consultation Report, the sender system MUST inform an appropriate person"
  page: sendupdate_errors.html
